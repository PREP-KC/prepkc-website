<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8TKE4R10Y3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-8TKE4R10Y3');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Join PREP-KC's Virtual Events including teacher-requested sessions and career exploration opportunities. Connect with students virtually to share your career pathway and expertise.">
    <title>Virtual Events - PREP-KC Kansas City Volunteer Opportunities</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://prepkc.org/virtual">
    <meta property="og:title" content="Virtual Events - PREP-KC Kansas City">
    <meta property="og:description" content="Volunteer for PREP-KC's Virtual Events. Connect with students through teacher-requested sessions and share your career expertise from anywhere.">
    <meta property="og:image" content="https://prepkc.org/img/DSI-PrepKC.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://prepkc.org/virtual">
    <meta property="twitter:title" content="Virtual Events - PREP-KC Kansas City">
    <meta property="twitter:description" content="Join PREP-KC's Virtual Events. Help students explore careers through virtual sessions and teacher-requested presentations.">
    <meta property="twitter:image" content="https://prepkc.org/img/DSI-PrepKC.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://prepkc.org/virtual">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css?v=1.1">
    <link rel="stylesheet" type="text/css" href="css/virtual.css?v=1.1">
    <script src="https://unpkg.com/htmx.org@2.0.1" integrity="sha384-QWGpdj554B4ETpJJC9z+ZHJcA/i59TyjxEPXiiUgN2WmTyV5OEZWCD6gQhgkdpB/" crossorigin="anonymous"></script>
</head>
<body class="container">
    <!-- Skip navigation link for accessibility -->
    <a href="#main-content" class="visually-hidden-focusable btn btn-primary position-absolute" style="top: 10px; left: 10px; z-index: 1000;">Skip to main content</a>
    
    <div id="nav-container"></div>
    <div hx-get="nav.html" hx-target="#nav-container" hx-trigger="load"></div>
    
    <!-- Breadcrumb navigation -->
    <nav aria-label="breadcrumb" class="mt-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html" class="text-turquoise">Home</a></li>
            <li class="breadcrumb-item"><a href="volunteer.html" class="text-turquoise">Volunteer</a></li>
            <li class="breadcrumb-item active text-white" aria-current="page">Virtual Events</li>
        </ol>
    </nav>
    
    <!-- Main content with proper semantic structure -->
    <div id="main-content">
        <main role="main">
            <h1 class="text-center text-yellow mb-3">Virtual Events</h1>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="row align-items-end g-3">
                    <div class="col-auto">
                        <h6 class="text-navy mb-0">Filter Events:</h6>
                    </div>
                    <div class="col-auto">
                        <label for="searchText" class="form-label small">Search:</label>
                        <input type="text" class="form-control form-control-sm" id="searchText" placeholder="Title or topic...">
                    </div>
                    <div class="col-auto">
                        <label for="districtFilter" class="form-label small">District:</label>
                        <select class="form-control form-control-sm" id="districtFilter">
                            <option value="">All Districts</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <label for="topicFilter" class="form-label small">Topic:</label>
                        <select class="form-control form-control-sm" id="topicFilter">
                            <option value="">All Topics</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <label for="startDate" class="form-label small">From:</label>
                        <input type="date" class="form-control form-control-sm" id="startDate">
                    </div>
                    <div class="col-auto">
                        <label for="endDate" class="form-label small">To:</label>
                        <input type="date" class="form-control form-control-sm" id="endDate">
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-primary btn-sm" onclick="filterEvents()">Filter</button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearFilter()">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Events Cards -->
            <div id="virtual-events-container">
                <!-- Events will be dynamically loaded here -->
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set academic year range automatically (August to July)
            setAcademicYearRange();
            
            // Use the real virtual events API endpoint
            fetch('https://voluntold-prepkc.pythonanywhere.com/api/virtual-events')
                .then(response => response.json())
                .then(events => {
                    console.log('Events loaded:', events);
                    
                    // Store all events globally for filtering
                    window.allEvents = events;
                    
                    // Filter events that should be displayed
                    const virtualEvents = events.filter(event => 
                        event.display_on_website === true && 
                        event.status === 'active'
                    );
                    
                    console.log('Filtered virtual events:', virtualEvents);
                    
                    // Populate filter dropdowns
                    populateFilterDropdowns(virtualEvents);
                    
                    // If no events at all, show message and return
                    if (virtualEvents.length === 0) {
                        const container = document.getElementById('virtual-events-container');
                        container.innerHTML = `
                            <div class="no-events">
                                <h3 class="text-yellow">No Upcoming Virtual Events</h3>
                                <p class="text-white">There are currently no upcoming virtual volunteer opportunities. Please check back later.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Create cards with all events
                    createEventsTable(virtualEvents);
                })
                .catch(error => {
                    console.error('Error loading virtual events:', error);
                    document.getElementById('virtual-events-container').innerHTML = 
                        '<div class="alert alert-danger">Error loading events. Please try again later.</div>';
                });
        });
        
        // Populate filter dropdowns with unique values from events
        function populateFilterDropdowns(events) {
            // Get unique districts
            const districts = [...new Set(events.map(event => event.district).filter(Boolean))].sort();
            const districtSelect = document.getElementById('districtFilter');
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
            
            // Get unique topics
            const topics = [...new Set(events.map(event => event.topic_theme).filter(Boolean))].sort();
            const topicSelect = document.getElementById('topicFilter');
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicSelect.appendChild(option);
            });
        }
        
        // Set academic year range automatically
        function setAcademicYearRange() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1; // January is 0
            
            let startYear, endYear;
            
            // Academic year runs from August to July
            if (currentMonth >= 8) { // August or later
                startYear = currentYear;
                endYear = currentYear + 1;
            } else { // Before August
                startYear = currentYear - 1;
                endYear = currentYear;
            }
            
            // Set default date range (August 1 to July 31)
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            startDate.value = `${startYear}-08-01`;
            endDate.value = `${endYear}-07-31`;
        }

         // Helper function to create events cards
         function createEventsTable(events) {
             const container = document.getElementById('virtual-events-container');
             
             if (events.length === 0) {
                 container.innerHTML = `
                     <div class="no-events">
                         <h3 class="text-yellow">No Events Found</h3>
                         <p class="text-white">No events match your current filter criteria.</p>
                     </div>
                 `;
                 return;
             }
             
             const cardsHTML = `
                 <div class="events-cards">
                     <div class="row g-4">
                         ${events.map(event => {
                             // Parse date and time
                             const dateTimeStr = event.date_and_time || event.Date_and_Time_for_Cal__c;
                             const dateMatch = dateTimeStr.match(/(\d{1,2}\/\d{1,2}\/\d{2,4})/);
                             const timeMatch = dateTimeStr.match(/(\d{1,2}:\d{2}\s*[AP]M)/);
                             
                             const date = dateMatch ? dateMatch[1] : dateTimeStr;
                             const time = timeMatch ? timeMatch[1] : 'TBD';
                             
                             // Get district and topic information
                             const district = event.district || 'Kansas City Area';
                             const topic = event.topic_theme || null;
                             
                             return `
                                 <div class="col-xl-3 col-lg-4 col-md-6">
                                     <div class="event-card">
                                         <div class="card-header">
                                             <h5 class="event-title">${event.name || event.Name}</h5>
                                         </div>
                                         <div class="card-body">
                                             <div class="event-details">
                                                 <div class="event-date">
                                                     <i class="fas fa-calendar-alt"></i>
                                                     <span>${date}</span>
                                                 </div>
                                                 <div class="event-time">
                                                     <i class="fas fa-clock"></i>
                                                     <span>${time}</span>
                                                 </div>
                                                 <div class="event-district">
                                                     <i class="fas fa-map-marker-alt"></i>
                                                     <span>${district}</span>
                                                 </div>
                                                 ${topic ? `
                                                 <div class="event-topic">
                                                     <i class="fas fa-lightbulb"></i>
                                                     <span>${topic}</span>
                                                 </div>
                                                 ` : ''}
                                             </div>
                                             <div class="card-footer">
                                                 <a href="${event.registration_link || event.Registration_Link__c}" 
                                                    target="_blank" 
                                                    class="register-btn">
                                                     Register
                                                 </a>
                                             </div>
                                         </div>
                                     </div>
                                 </div>
                             `;
                         }).join('')}
                     </div>
                 </div>
             `;
             container.innerHTML = cardsHTML;
         }

         // Filter events by all criteria
         function filterEvents() {
             const searchText = document.getElementById('searchText').value.toLowerCase();
             const districtFilter = document.getElementById('districtFilter').value;
             const topicFilter = document.getElementById('topicFilter').value;
             const startDate = document.getElementById('startDate').value;
             const endDate = document.getElementById('endDate').value;
             
             const filteredEvents = window.allEvents.filter(event => {
                 // Basic filters
                 if (event.display_on_website !== true || event.status !== 'active') {
                     return false;
                 }
                 
                 // Search filter (title or topic)
                 if (searchText) {
                     const titleMatch = (event.name || event.Name || '').toLowerCase().includes(searchText);
                     const topicMatch = (event.topic_theme || '').toLowerCase().includes(searchText);
                     if (!titleMatch && !topicMatch) {
                         return false;
                     }
                 }
                 
                 // District filter
                 if (districtFilter && event.district !== districtFilter) {
                     return false;
                 }
                 
                 // Topic filter
                 if (topicFilter && event.topic_theme !== topicFilter) {
                     return false;
                 }
                 
                 // Date range filter
                 if (startDate || endDate) {
                     const eventDate = new Date(event.start_date || event.Start_Date__c);
                     
                     if (startDate && endDate) {
                         const start = new Date(startDate);
                         const end = new Date(endDate);
                         if (eventDate < start || eventDate > end) {
                             return false;
                         }
                     } else if (startDate) {
                         const start = new Date(startDate);
                         if (eventDate < start) {
                             return false;
                         }
                     } else if (endDate) {
                         const end = new Date(endDate);
                         if (eventDate > end) {
                             return false;
                         }
                     }
                 }
                 
                 return true;
             });
             
             createEventsTable(filteredEvents);
         }

         // Clear all filters
         function clearFilter() {
             document.getElementById('searchText').value = '';
             document.getElementById('districtFilter').value = '';
             document.getElementById('topicFilter').value = '';
             document.getElementById('startDate').value = '';
             document.getElementById('endDate').value = '';
             
             const virtualEvents = window.allEvents.filter(event => 
                 event.display_on_website === true && 
                 event.status === 'active'
             );
             createEventsTable(virtualEvents);
         }

         // Auto-refresh every 2.5 hours
         setInterval(() => {
             var container = document.getElementById('virtual-events-container');
             htmx.ajax('GET', 'virtual.html', '#virtual-events-container');
         }, 300000*30);
    </script>

    <!-- FOOTER -->
    <footer>
        <div class="footer row">
            <div class="footer-text col">
                <p>PREP-KC<br>info@prepkc.org<br>2300 Main St, Suite 340<br>Kansas City, MO 64108<br>816.931.PREP</p>
            </div>
            <div class="footer-social col">
                <p>Connect</p>
                <a href="https://www.facebook.com/prepkc/" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                <a href="https://twitter.com/PREPKC" class="social-icon"><i class="fab fa-twitter"></i></a>
                <a href="https://www.linkedin.com/company/prep-kc/" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
